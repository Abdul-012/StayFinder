<% layout('layouts/boilerplate') -%>

<body>
   <h2><%= listing.title %></h2>
<br>
    <div class="card" style="width: 25rem;">
      <img src="<%= typeof listing.image === 'string' ? listing.image : listing.image.url %>" 
       class="card-img-top"
       alt="<%= listing.title %>" 
       style="height: 180px; object-fit: cover;"/>
      <div class="card-body">
        <ul>
          <li><%= listing.description %></li>
          <li><%= listing.price %></li>
          <li><%= listing.location %></li>
          <li><%= listing.country %></li>
        </ul>
      </div>
    </div>

    <div>
      <a href="/listings/<%=listing._id%>/edit" class="btn btn-warning">Edit the Listings</a>
      <br><br>
      <form action="/listings/<%=listing._id%>?_method=DELETE" method="POST">
        <button type="submit" class="btn btn-danger">Delete Listing</button>
      </form>
      <br>
      <!-- <a href="/listings" class="btn btn-secondary">Back to Listings</a> -->
    </div>
    <hr>

    <div class="mb-3 mt-3 col-8 offset-2 mt-3">
       <h3>Leave a Review:</h3>
       <form action="/listings/<%= listing._id %>/reviews" method="POST" novalidate class="needs-validation">
           <label for="rating" class="form-label">Rating:</label>
           <input type="number" id="rating" name="review[Rating]" min="1" max="5" class="form-control" required>
           <div class="form-text mb-3 mt-3">Please provide a rating from 1 to 5.</div>

           <label for="comment" class="form-label">Comment:</label>
           <textarea id="comment" name="review[Comment]" rows="4" cols="50" class="form-control" required></textarea>

           <br>
           <button type="submit" class="btn btn-primary">Submit Review</button>
       </form>
    <hr>

    <h3>All Reviews:</h3>
 <div class="row">
    <% for(let review of listing.reviews) { %>
      <div class="card col-5 ms-4 mt-4 mb-4">
        <div class="card-body">
          <h5 class="card-title">Review by <%= review.username %></h5>
          <p class="card-text"><%= review.Comment %></p>
          <strong>Rating:</strong> <%= review.Rating %> Stars
          <br>
        </div>
        <form class="mb-3" action="/listings/<%= listing._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
            <button class="btn btn-sm btn-dark mt-3">Delete</button>
        </form>
      </div>
      <br>
    <% } %>
</div>
    </div> 
</body>
</html>
